<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reprogramar Cita</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Tu CSS global -->
  <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body class="bg-page">

  <!-- BARRA SUPERIOR -->
  <header class="bg-mep text-white py-2 shadow-sm">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <div class="d-flex align-items-center gap-3">
        <img th:src="@{/img/mep-logo.png}" alt="MEP" height="36" />
        <h1 class="h6 m-0 fw-semibold">MEP - Matrículas y Educación Pública</h1>
      </div>
      <a th:href="@{/tutor/citas}" class="btn btn-light btn-sm">Volver a mis citas</a>
    </div>
  </header>

  <!-- SUBNAV -->
  <nav class="bg-mep-700 text-white">
    <div class="container d-flex gap-4 py-2 small">
      <a class="nav-link-lite" th:href="@{/faq}">Preguntas Frecuentes</a>
      <a class="nav-link-lite" th:href="@{/ayuda}">Ayuda</a>
      <a class="nav-link-lite" th:href="@{/contacto}">Contáctanos</a>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <main class="container my-4">
    <div class="reprog-card shadow-sm rounded-3 p-4 p-lg-5 mx-auto">
      <h2 class="h5 text-center mb-4">Reprogramar Cita</h2>

      <!-- Resumen actual -->
      <div class="row g-3 reprog-summary mb-4">
        <div class="col-12 col-md-6">
          <div class="sum-item">
            <strong>Institución</strong>
            <span th:text="${cita.institucion.nombre}">Nombre institución</span>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="sum-item">
            <strong>Fecha actual</strong>
            <span th:text="${cita.fechaCita}">2025-09-21</span>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="sum-item">
            <strong>Hora actual</strong>
            <span th:text="${cita.horaCita}">14:00</span>
          </div>
        </div>
      </div>

      <!-- Formulario: mantiene name="fecha" y name="hora" -->
      <form th:action="@{|/tutor/citas/${cita.id}/reprogramar|}" method="post" id="reprogForm" novalidate>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="mb-3">
          <label for="fecha" class="form-label fw-semibold">Nueva fecha</label>
          <input type="date" id="fecha" name="fecha" class="form-control" required>
        </div>

        <!-- Hora con AM/PM visible + input oculto 'hora' (HH:mm) para el backend -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Nueva hora</label>
          <div class="row g-2">
            <div class="col-5">
              <select id="hour12" class="form-select" aria-label="Hora" required>
                <option value="" disabled selected>Hora</option>
                <option th:each="h : ${#numbers.sequence(1,12)}" th:value="${h}" th:text="${h}"></option>
              </select>
            </div>
            <div class="col-5">
              <select id="minute" class="form-select" aria-label="Minutos" required>
                <option value="" disabled selected>Minutos</option>
                <option value="00">00</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="45">45</option>
              </select>
            </div>
            <div class="col-2">
              <select id="ampm" class="form-select" aria-label="AM o PM" required>
                <option value="AM" selected>AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
          </div>
          <!-- Este es el parámetro que recibirá tu backend -->
          <input type="hidden" id="hora" name="hora" required>
        </div>

        <!-- Acciones -->
        <div class="row g-2">
          <div class="col-12 col-md-6">
            <button type="submit" class="btn btn-success w-100">Guardar cambios</button>
          </div>
          <div class="col-12 col-md-6">
            <a th:href="@{/tutor/citas}" class="btn btn-outline-secondary w-100">Cancelar</a>
          </div>
        </div>
      </form>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Compone 'hora' (HH:mm) desde 12h + AM/PM sin cambiar tu backend -->
  <script>
    (function(){
      const form = document.getElementById('reprogForm');
      const hidden = document.getElementById('hora');
      const hSel   = document.getElementById('hour12');
      const mSel   = document.getElementById('minute');
      const apSel  = document.getElementById('ampm');

      function to24h(h12, ap){
        let h = parseInt(h12 || 0, 10);
        if(ap === 'PM' && h !== 12) h += 12;
        if(ap === 'AM' && h === 12) h = 0;
        return String(h).padStart(2,'0');
      }
      function updateHidden(){
        if(!hSel.value || !mSel.value || !apSel.value) { hidden.value = ''; return; }
        const hh = to24h(hSel.value, apSel.value);
        const mm = String(parseInt(mSel.value,10)).padStart(2,'0');
        hidden.value = `${hh}:${mm}`;
      }
      [hSel, mSel, apSel].forEach(el => el.addEventListener('change', updateHidden));
      form.addEventListener('submit', e => {
        updateHidden();
        if(!hidden.value){
          e.preventDefault();
          alert('Selecciona la nueva hora (AM/PM).');
        }
      });
    })();
  </script>
</body>
</html>
